@model IEnumerable<BookShoppingCartMvcUI.Models.DTOs.BooksByGenreSectionModel>
@using BookShoppingCartMvcUI.Models.DTOs

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Trang chủ</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="~/css/index.css">
</head>
<body>
    <!-- BANNER + SÁCH BÁN CHẠY -->
    <div class="container-fluid p-0 mt-3">
        <div class="row g-3">

            <!-- Banner trái -->
            <div class="col-md-8">
                <div class="h-100 border rounded shadow-sm overflow-hidden">
                    <a href="/Home/Index"><img src="~/images/banner2.jpg" class="img-fluid w-100 h-100"
                        alt="Banner" style="object-fit:cover; max-height:auto;">
                    </a>
                </div>
            </div>

            <!-- Sách bán chạy bên phải -->
            <div class="col-md-4">          
                    @await Component.InvokeAsync("HomeTopSellingBooks", new { view = "Sidebar" })
            </div>

        </div>
    </div>



    <!-- DANH MỤC SẢN PHẨM -->
    <div class="container my-4">
        @await Component.InvokeAsync("GenreList")
    </div>

    <!-- SÁCH GỢI Ý -->
    @if (ViewBag.RecommendedBooks != null && (ViewBag.RecommendedBooks as IEnumerable<BookDTO>).Any())
    {
            <div class="container my-5">
            @Html.Partial("~/Views/Shared/Partials/_Recommendation.cshtml", ViewBag.RecommendedBooks as IEnumerable<BookDTO>)
            </div>
    }

    <!-- SÁCH NỔI BẬT -->
    <div class="container my-5 featured-books-section rounded-4 shadow-sm p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="fw-bold text-white mb-0">
                <i class="bi bi-star-fill me-2"></i> Sách nổi bật
            </h4>
        </div>

        @foreach (var section in Model)
        {
            @Html.Partial("~/Views/Shared/Partials/_BooksByCategorySection.cshtml", section)
        }
    </div>

    <!-- BẢNG XẾP HẠNG -->
    <div class="container my-5">
        @await Component.InvokeAsync("HomeTopSellingBooks")
    </div>

    <!-- FOOTER -->
    <footer class="bg-white border-top mt-5 pt-4 pb-2">
        @section Footer {
            @await Html.PartialAsync("_Footer")
        }
    </footer>

    <!-- Script: Click vào sách đầu tiên sau khi DOM sẵn sàng -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const firstBook = document.getElementById("firstBook");
            if (firstBook) {
                firstBook.click();
            }
        });
    </script>

    <!-- Script: Scroll nút điều hướng danh mục -->
    <script>
        const scrollContainer = document.getElementById("categoryScroll");

        document.querySelector(".scroll-left")?.addEventListener("click", function () {
            scrollContainer.scrollBy({ left: -200, behavior: 'smooth' });
        });

        document.querySelector(".scroll-right")?.addEventListener("click", function () {
            scrollContainer.scrollBy({ left: 200, behavior: 'smooth' });
        });
    </script>

    <!-- Swiper -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <script src="~/js/index.js"></script>
    <script>
        async function addToCart(bookId) {
            var usernameEl = document.getElementById("username");
            if (!usernameEl) {
                window.location.href = "/Identity/Account/Login";
                return;
            }

            try {
                var response = await fetch(`/Cart/AddItem?bookId=${bookId}&qty=1`);
                if (response.status === 200) {
                    let result = await response.json();
                    document.getElementById("cartCount").innerHTML = result;
                    alert("Đã thêm vào giỏ hàng!");
                }
            } catch (err) {
                console.error("Lỗi thêm vào giỏ hàng:", err);
            }
        }
    </script>

</body>
</html>
